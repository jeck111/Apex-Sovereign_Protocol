// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts/token/ERC20/ERC20.sol";
import "@openzeppelin/contracts/access/AccessControl.sol";
import "@openzeppelin/contracts/utils/Pausable.sol";

contract ApexUltra is ERC20, AccessControl, Pausable {
    bytes32 public constant ADMIN_ROLE = keccak256("ADMIN_ROLE");
    bytes32 public constant ELITE_MEMBER_ROLE = keccak256("ELITE_MEMBER_ROLE");

    uint256 public constant REWARD_PERCENT = 2; // Auto-Staking Rewards
    uint256 public constant EARTH_TAX = 1;      // Global Economy Support
    
    address public earthFundVault;
    uint256 public maxTransactionAmount;

    constructor(address _admin, address _vault) ERC20("APEX ULTRA", "APX") {
        _grantRole(DEFAULT_ADMIN_ROLE, _admin);
        _grantRole(ADMIN_ROLE, _admin);
        _grantRole(ELITE_MEMBER_ROLE, _admin);
        
        earthFundVault = _vault;
        uint256 totalWealth = 1000000 * 10**decimals();
        _mint(_admin, totalWealth);
        
        maxTransactionAmount = (totalWealth * 1) / 100; // 1% limit per txn
    }

    function grantEliteStatus(address account) external onlyRole(ADMIN_ROLE) {
        _grantRole(ELITE_MEMBER_ROLE, account);
    }

    function setPause(bool _state) external onlyRole(ADMIN_ROLE) {
        _state ? _pause() : _unpause();
    }

    function _update(address from, address to, uint256 amount) internal override whenNotPaused {
        if (from != address(0) && to != address(0)) {
            require(hasRole(ELITE_MEMBER_ROLE, from), "APEX: Access Denied. Not an Elite Member.");
            require(amount <= maxTransactionAmount, "APEX: Exceeds Elite Transfer Limit.");

            uint256 rewardAmount = (amount * REWARD_PERCENT) / 100;
            uint256 taxAmount = (amount * EARTH_TAX) / 100;
            uint256 finalAmount = amount - (rewardAmount + taxAmount);

            super._update(from, earthFundVault, taxAmount);
            super._update(from, address(this), rewardAmount); // Distributed to holders/staking
            super._update(from, to, finalAmount);
        } else {
            super._update(from, to, amount);
        }
    }
}

