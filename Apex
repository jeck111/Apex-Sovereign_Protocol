// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

/**
 * @title APEX Global Reserve (APX)
 * @dev Elite-only cryptocurrency with built-in Earth Tax for global economy support.
 */

import "@openzeppelin/contracts/token/ERC20/ERC20.sol";
import "@openzeppelin/contracts/access/Ownable.sol";

contract ApexCoin is ERC20, Ownable {
    
    // વ્હાઇટલિસ્ટ: માત્ર મંજૂર થયેલા અમીર લોકો જ ટ્રેડ કરી શકશે
    mapping(address => bool) public isWhitelisted;
    
    // પૃથ્વી કલ્યાણ ટેક્સ (૨%)
    uint256 public constant EARTH_TAX_PERCENT = 2;
    address public earthFundWallet;

    event AddedToWhitelist(address indexed account);
    event RemovedFromWhitelist(address indexed account);
    event EarthTaxPaid(address indexed from, uint256 amount);

    constructor(address _earthFundWallet) ERC20("APEX", "APX") Ownable(msg.sender) {
        earthFundWallet = _earthFundWallet;
        
        // સ્થાપક (તમે) ને ઓટોમેટિક વ્હાઇટલિસ્ટમાં એડ કરવા
        isWhitelisted[msg.sender] = true;
        
        // ટોટલ સપ્લાય: ૧૦,૦૦,૦૦૦ (૧૦ લાખ) APX
        _mint(msg.sender, 1000000 * 10**decimals());
    }

    // નવા મેમ્બરને એડ કરવા માટે (Only Owner)
    function addToWhitelist(address _account) external onlyOwner {
        isWhitelisted[_account] = true;
        emit AddedToWhitelist(_account);
    }

    // મેમ્બરને દૂર કરવા માટે
    function removeFromWhitelist(address _account) external onlyOwner {
        isWhitelisted[_account] = false;
        emit RemovedFromWhitelist(_account);
    }

    // ટેક્સ વોલેટ બદલવા માટે
    function setEarthFundWallet(address _newWallet) external onlyOwner {
        earthFundWallet = _newWallet;
    }

    // ટ્રાન્સફર ફંક્શન: વ્હાઇટલિસ્ટ અને ટેક્સ ચેક કરશે
    function _update(address from, address to, uint256 amount) internal virtual override {
        // Minting (શરૂઆતના કોઈન) સિવાયના તમામ ટ્રાન્ઝેક્શન માટે
        if (from != address(0) && to != address(0)) {
            require(isWhitelisted[from], "Sender is not an authorized elite member.");
            require(isWhitelisted[to], "Receiver is not an authorized elite member.");

            uint256 taxAmount = (amount * EARTH_TAX_PERCENT) / 100;
            uint256 finalAmount = amount - taxAmount;

            // ૨% ટેક્સ પૃથ્વી ફંડમાં મોકલો
            super._update(from, earthFundWallet, taxAmount);
            // બાકીના ૯૮% રિસીવરને મોકલો
            super._update(from, to, finalAmount);

            emit EarthTaxPaid(from, taxAmount);
        } else {
            // Minting અથવા Burning માટે સામાન્ય ટ્રાન્સફર
            super._update(from, to, amount);
        }
    }
}
